{% extends "volunteering/base.html" %}

<!-- Home page -->
 
 {% block title %}SAVS Volunteering{% endblock %}

 {% block content %}

 <!-- script to set up the modal for each addition -->
<script type="text/javascript">
$(document).ready(function() {
	$(".modal-trigger").click(function() {
		var button = $(this);
		var title = "Add " + button.data('volunteer-name') + " as a participant"
		var id = button.data('id');
		$('#submitModal').find('.modal-title').text(title);
		$('#user_id').val(id);
		$('#modal_keyword').val($('#form_keyword').val())
		$('#submitModal').modal('show');
	});
	$("#modal_submit_button").click(function() {
		$("#modal_form_submit").click();
	})
});
</script>

<!-- Modal -->
<div id="submitModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
     	<div class="modal-header savs-modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h4 class="modal-title">Modal Title</h4>
      	</div>
		<div class="modal-body savs-modal-body">
			<form action="{% url 'participants' opportunity.pk %}" method="post">
				{% csrf_token %}
				<label for="comments">Comments:</label>
				<textarea name="comments" class="form-control" maxlength="1000" required id="comments"></textarea>
				<input type="submit" name="action" value="add" id="modal_form_submit" style="display:none">
				<input type="hidden" name="user_id" id="user_id" value="default_value">
				<input type="hidden" name="keyword" id="modal_keyword" value="{{ keyword }}">
			</form>
		</div>
      <div class="modal-footer savs-modal-footer">
         <button type="button" class="btn savs-pink-button" id="modal_submit_button">Submit</button>
        <button type="button" class="btn savs-pink-button" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

 <div class="container">
		<div class="panel panel-primary">
			<div class="panel-heading panel-heading-savs-pink">
				<h1 class="panel-title">Add Participants to {{ opportunity.title }} for {{ opportunity.organisation.name }}</h1>
			</div>
			<div class="panel-body panel-body-light-pink">
				<div class="row">
					<div class="col-md-6">
						<h5><strong>Volunteers Interested in Opportunity</strong></h5>
						{% if opportunity_actions %}
							{% for opportunity_action in opportunity_actions %}
								{% if opportunity_action.opportunity_action_type.name != 'participated' %}
									<input type="button" value="Add" class="btn modal-trigger btn-sm savs-pink-button" data-id="{{ opportunity_action.user.pk }}" data-volunteer-name="{{ opportunity_action.user.first_name }} {{ opportunity_action.user.last_name }}">
									{{ opportunity_action.user.first_name }} {{ opportunity_action.user.last_name }} - {{ opportunity_action.opportunity_action_type.name }}
								{% endif %}
							{% endfor %}
						{% else %}
							No more volunteers for this opportunity.
						{% endif %}
						{% if user_role.is_vc_staff %}
							<h5><strong>Search for More Volunteers</strong></h5>
							<form action="{% url 'participants' opportunity.pk %}" method="post" class="form-inline">
								{% csrf_token %}
								<input type="text" name="keyword" id="form_keyword" class="form-control" placeholder="Search" maxlength="30" value="{{ keyword }}">
								<input type="submit" class="btn savs-pink-button" name="action" value="Search" id="modal_form_submit">
							</form>
							{% if search_volunteers %}
								{% for search_volunteer in search_volunteers %}
									<table>
										<tr>
											<td class="table-pad">
												<input type="button" value="Add" class="btn modal-trigger btn-sm savs-pink-button" data-id="{{ search_volunteer.user.pk }}" data-volunteer-name="{{ search_volunteer.user.first_name }} {{ search_volunteer.user.last_name }}">
											</td>
											<td>{{ search_volunteer.user.first_name }} {{ search_volunteer.user.last_name }}</td>
										</tr>
									</table>
								{% endfor %}
							{% endif %}
						{% endif %}
					</div>
					<div class="col-md-6">
						<h5><strong>Participants</strong></h5>
						{% for opportunity_action in opportunity_actions %}
							{% if opportunity_action.opportunity_action_type.name == 'participated' %}
								{{ opportunity_action.user.first_name }} {{ opportunity_action.user.last_name }}<br>
							{% endif %}
						{% endfor %}
					</div>
				</div>
			</div>
			<div class="panel-footer panel-footer-mid-pink"></div>
		</div>

		<div>
			{% include "volunteering/opportunity_volunteer_table.html" %}
		</div>

 </div>

 {% endblock %}

